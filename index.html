<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
    <style type="text/css">
      .name {
        font-size: 80px;
        float: left;
        width: 400px;
      }
      
      .picture {
        float: right;
      }
      
    </style>
  </head>
  <body class="mixpanel-platform-body">
    <div class="wrapper">
      <div class="name"></div>
      <div class="picture"><img style="width: 800px; height: 800px;" /></div>
      <div class="time"></div>
    </div>
    <script>
      var pictures = {
        'alex': 'https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-frc3/v/t1.0-9/228552_6101966231_4401_n.jpg?oh=d6a7941da50785b9001310eb79961aa2&oe=56031A1C&__gda__=1438832515_4cd469ad89a88132fa6462c79a2ee15a',
        'alexs': 'https://scontent-sjc.xx.fbcdn.net/hphotos-xpa1/t31.0-8/243633_10150931201270918_1791364558_o.jpg',
        'anlu': 'https://scontent-sjc.xx.fbcdn.net/hphotos-xap1/v/t1.0-9/1235358_10200341623134837_906562923_n.jpg?oh=2bd967b49153c7f4f9b9bb9f847817aa&oe=56039114',
        'ajo': 'http://photos2.meetupstatic.com/photos/member/e/4/d/e/member_241678590.jpeg',
        'epurcer': 'https://scontent-sjc.xx.fbcdn.net/hphotos-xat1/v/t1.0-9/10294353_10154221994335045_9045017841824365587_n.jpg?oh=6ab1779a7de73b45332db86830097522&oe=56061C6C',
        'joe': 'https://scontent-sjc.xx.fbcdn.net/hphotos-xaf1/t31.0-8/135103_10101333803329325_1520239732_o.jpg',
        'josh': 'https://scontent-sjc.xx.fbcdn.net/hphotos-ash2/t31.0-8/242679_804980869806_694945237_o.jpg',
        'neil': 'https://scontent-sjc.xx.fbcdn.net/hphotos-xfp1/v/t1.0-9/1933768_513702444157_3159_n.jpg?oh=972217240754899d4601c1102d84a238&oe=55CE63D8',
        'rob': 'https://media.licdn.com/media/p/5/000/1fd/161/19e6118.jpg',
        'ted': 'https://i.ytimg.com/vi/yhBGISTfXdo/hqdefault.jpg',
        'tim': 'https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-frc3/v/t1.0-9/1237054_10102844018630761_576615532_n.jpg?oh=ca24fd2a7ab718119f4f6dea9da087be&oe=560D5B56&__gda__=1439145755_9d39feb432ed928a46006ca6415e6931',
        'zak': 'https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/131819_474218435748_6063398_o.jpg'
      };
      var feed = [];
      var carouselInterval;
      var carouselIdx = -1;
      var getFeed = function() {
        MP.api.query("/api/2.0/live").done(function(resp) {
          feed = [];
          _.each(resp, function(event) {
            if (feed.length > 15) feed.shift();
            feed.push({user: event.properties.user, description: event.properties.description, ts: event.$ts});
          });
          carouselIdx = -1;
          clearInterval(carouselInterval);
          displayNextItem();
          setInterval(displayNextItem, 5000);
        });
      };
      
      var displayNextItem = function() {
        if (carouselIdx == feed.length - 1) {
          carouselIdx = 0;
        } else {
          carouselIdx++;
        }
        
        item = feed[carouselIdx];
        $('.name').text(item.user + " deployed " + item.description);
        $('.picture img').attr('src', pictures[item.user]);
        $('.time').text(item.ts);
      };
      
      getFeed();
    </script>
  </body>
</html>
